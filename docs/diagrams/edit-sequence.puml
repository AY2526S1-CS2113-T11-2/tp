@startuml
!theme vibrant
actor User
participant ":Main" as Main
participant ":Parser" as Parser
participant ":ArgumentParser" as ArgumentParser
participant ":InputValidator" as InputValidator
participant ":EditCommand" as EditCommand
participant ":ExpenseManager" as ExpenseManager
participant ":Ui" as Ui

User -> Main : enters "edit id/1 a/15 desc/dinner cat/food"
activate Main

Main -> Parser : parse("edit id/1 a/15 desc/dinner cat/food")
activate Parser

create ArgumentParser
Parser -> ArgumentParser : extract prefixes
activate ArgumentParser
Parser -> ArgumentParser : getValue("id/")
ArgumentParser --> Parser : "1"
Parser -> ArgumentParser : getOptionalValue("a/")
ArgumentParser --> Parser : "15"
Parser -> ArgumentParser : getOptionalValue("desc/")
ArgumentParser --> Parser : "dinner"
Parser -> ArgumentParser : getOptionalValue("cat/")
ArgumentParser --> Parser : "food"
deactivate ArgumentParser

Parser -> InputValidator : validate id/amount/description/category
activate InputValidator

alt validation succeeds
    InputValidator --> Parser : validation OK
    deactivate InputValidator

    create EditCommand
    Parser -> EditCommand : (1, 15.0, "dinner", "food")
    Parser --> Main : EditCommand
    deactivate Parser

    Main -> EditCommand : execute(expenseManager, ui)
    activate EditCommand

    EditCommand -> ExpenseManager : getExpense(1)
    activate ExpenseManager
    ExpenseManager --> EditCommand : Expense(original)
    deactivate ExpenseManager

    EditCommand -> ExpenseManager : replaceExpense(1, edited)
    activate ExpenseManager
    deactivate ExpenseManager

    alt no fields changed
        EditCommand -> Ui : showEmptyEdit(...)
        activate Ui
        Ui --> User : "No changes made"
        deactivate Ui
    else fields updated
        EditCommand -> Ui : showEditedExpense(...)
        activate Ui
        Ui --> User : updated expense info
        deactivate Ui

        opt expense marked and amount changed
            EditCommand -> Ui : showProgressBar(...)
            activate Ui
            Ui --> User : updated budget progress
            deactivate Ui
        end
    end

    deactivate EditCommand
else validation fails
    InputValidator -->> Parser : OrCashBuddyException
    deactivate InputValidator
    Parser --> Main : InvalidCommand
    deactivate Parser

    Main -> Ui : showError(...)
    activate Ui
    Ui --> User : error message
    deactivate Ui
end

deactivate Main
@enduml
